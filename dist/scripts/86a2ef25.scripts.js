"use strict";angular.module("mainApp",["ngCookies","ngResource","ngSanitize","ngRoute","sharedApp","ui.bootstrap","ui.mask"]).config(["$routeProvider",function(a){a.when("/:lang",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/en"})}]),angular.module("mainApp").controller("MainCtrl",["$scope","$routeParams","$modal","Contacts",function(a,b,c,d){function e(a,b){angular.forEach(a,function(a){a.selected=!1}),b.selected=!0}function f(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return c;return-1}a.lang=b.lang||"en",a.sort="",a.reverse=!1,a.sortByVariants=[{title:"Name",sort:"name",id:"sortByName"},{title:"Surname",sort:"surname",id:"sortBySurname"},{title:"Phone Number",sort:"phoneNumber",id:"sortByPhoneNumber"},{title:"Group",sort:"group",id:"sortByGroup"}],a.langVariants=[{title:"English",id:"en"},{title:"Русский",id:"ru"}],a.contacts=[],d.query().then(function(b){return a.contacts=b}),a.add=function(){c.open({templateUrl:"views/modal.html",controller:"ModalCtrl",resolve:{action:function(){return"add"},contact:function(){return null},lang:function(){return a.lang}}}).result.then(function(b){a.contacts.push(b)})},a.edit=function(b){c.open({templateUrl:"views/modal.html",controller:"ModalCtrl",resolve:{action:function(){return"edit"},contact:function(){return angular.copy(b)},lang:function(){return a.lang}}}).result.then(function(c){var d=f(a.contacts,b.id);a.contacts[d]=c})},a.delete=function(b){d.delete(b.id).then(function(c){if(c){var d=f(a.contacts,b.id);-1!==d&&a.contacts.splice(d,1)}})},a.makeTitle=function(a){var b=a.name;return a.surname&&(b+=" "+a.surname),a.group&&(b+=" ("+a.group+")"),b},a.sortBy=function(b){e(a.sortByVariants,b),a.reverse=a.sort===b.sort?!a.reverse:!1,a.sort=b.sort}}]),angular.module("mainApp").controller("ModalCtrl",["$scope","$modalInstance","Contacts","action","contact","lang",function(a,b,c,d,e,f){function g(c){c.err?a.error={error:!0,message:c.err.message}:b.close(c)}var h={error:!1};a.error=h,a.data=e||{},a.lang=f,a.action=d,a.save=function(b){"add"===a.action?c.save(b).then(g):"edit"===a.action&&c.update(b).then(g)},a.cancel=function(){b.dismiss("cancel")},a.$watch("data",function(){a.error=h},!0)}]),angular.module("sharedApp",["ngCookies","ngResource","ngSanitize","LocalStorageModule"]),angular.module("sharedApp").filter("l10n",function(){var a={ru:{New:"Новый",Contacts:"Контакты",Search:"Поиск","Sort by":"Сортировать",Name:"Имя",Surname:"Фамилия",Group:"Группа","Phone Number":"Номер телефона",Edit:"Редактировать",Delete:"Удалить","Toggle navigation":"Переключение навигации",Language:"Язык",Cancel:"Закрыть",Save:"Сохранить","Please fill out name.":"Пожайлуйста заполните имя.","Please fill out phone number.":"Пожайлуйста заполните номер телефона.",Error:"Ошибка",Contact:"Контакт"}};return function(b,c){return"en"===c?b:a[c]?a[c][b]||b:b}}),angular.module("sharedApp").filter("phone",function(){return function(a){return a.replace(/(\d)(\d{3})(\d{3})(\d{4})/,"+$1 ($2) $3-$4")}}),angular.module("sharedApp").service("Contacts",["$rootScope","$q","localStorageService",function a(b,c,d){function e(a){for(var b=g(),c=0;c<b.length;c++)if(b[c].id===a)return{contact:b[c],index:c};return{contact:null,index:-1}}function f(a){var d=c.defer();return setTimeout(function(){b.$apply(function(){a(d)})},15),d.promise}function g(){return d.get("contacts")}function h(a){d.set("contacts",a)}function i(){return parseInt(d.get("id"))}function j(a){d.set("id",a)}function k(){if(!i()&&!g()){var a=[{id:1,name:"Eka",surname:"Pusheva",phoneNumber:"79260000001",group:"family"},{id:2,name:"Alexandr",phoneNumber:"79255000000",group:"family"},{id:3,name:"Alexandr",phoneNumber:"79250000000"},{id:4,name:"Lena",surname:"Pusheva",phoneNumber:"79250000001"}],b=5;h(a),j(b)}}a.prototype.query=function(){return f(function(a){a.resolve(angular.copy(g()))})},a.prototype.get=function(a){return f(function(b){var c=e(a);b.resolve(angular.copy(-1!==c.index?c.contact:null))})},a.prototype.save=function(a){return f(function(b){a.id=i(),j(a.id+1);var c=g();c.push(a),h(c),b.resolve(angular.copy(a))})},a.prototype.update=function(a){return f(function(b){var c=e(a.id);if(-1!==c.index){var d=c.contact;d.name=a.name,d.surname=a.surname,d.phoneNumber=a.phoneNumber,d.group=a.group;var f=g();f[c.index]=d,h(f),b.resolve(angular.copy(d))}else b.resolve(angular.copy(null))})},a.prototype.delete=function(a){return f(function(b){var c=e(a).index;if(-1!==c){var d=g();d.splice(c,1),h(d),b.resolve(!0)}else b.resolve(!1)})},a.prototype.getId=function(){return i()},k()}]);